import{w as s}from"./index.DspQOGsj.js";function i(){const{subscribe:t,set:e,update:o}=s(null);return{subscribe:t,setToken:n=>e(n),clearToken:()=>e(null),getToken:()=>{let n=null;return t(c=>{n=c})(),n}}}const a=i(),l=s(null),r="http://localhost:3000/api";function u(){window.location.href=`${r}/auth/login`}function g(){a.clearToken(),l.set(null),window.location.href=`${r}/auth/logout`}async function w(){const t=new URLSearchParams(window.location.search),e=t.get("token");e&&(a.setToken(e),t.delete("token"),window.history.replaceState({},document.title,`${window.location.pathname}${t.toString()?"?"+t.toString():""}`),await h())}async function h(){try{console.log("Fetching user data from backend...");const t=a.getToken(),e=await fetch(`${r}/auth/profile`,{method:"GET",headers:{Authorization:t?`Bearer ${t}`:""},credentials:"include"});if(!e.ok){if(e.status===401)return console.log("User is not authenticated. Redirecting to login..."),u(),null;throw new Error(`Failed to fetch user data: ${e.statusText}`)}const o=await e.json();return console.log("User data received:",o),l.set(o),o}catch(t){return console.error("Error getting user data:",t),null}}export{u as a,h as g,w as h,a as j,g as l,l as u};
